<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | Karibu Groceries</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Main Styles -->
    <link rel="stylesheet" href="./css/main.css" />
  </head>
  <body>
    <!-- Dynamic Navbar Placeholder -->
    <div id="navbar-container"></div>

    <!-- Page Header-->
    <header class="dashboard-header">
      <div class="container">
        <h4 class="mb-1 fw-bold">Dashboard Overview</h4>
        <p class="page-subtitle">
          Branch: <strong id="userBranch">—</strong> •
          <span id="currentDate"></span>
        </p>
      </div>
    </header>

    <!-- Main page content -->
    <main class="container py-5">
      <!-- directors Snapshot -->
      <section class="role-director">
        <h4 class="section-title mb-3">Company Snapshot</h4>
        <div class="row g-4">
          <div class="col-md-4">
            <div class="summary-card highlight">
              <h5>Total Cash Sales</h5>
              <p class="summary-amount" id="dirCashTotal">UGX 0</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="summary-card">
              <h5>Outstanding Credit</h5>
              <p class="summary-amount" id="dirCreditTotal">UGX 0</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="summary-card">
              <h5>Total Stock (All Branches)</h5>
              <p class="summary-amount" id="dirStockTotal">0 KG</p>
            </div>
          </div>
        </div>
      </section>

      <!-- operational performance -->
      <section class="role-manager role-sales">
        <h4 class="section-title mb-3">Today’s Performance</h4>
        <div class="row g-4">
          <div class="col-md-3">
            <div class="summary-card highlight">
              <h5>Cash Sales Today</h5>
              <p class="summary-amount" id="cashToday">UGX 0</p>
            </div>
          </div>
          <div class="col-md-3 role-manager">
            <div class="summary-card">
              <h5>Outstanding Credit</h5>
              <p class="summary-amount" id="creditTotal">UGX 0</p>
            </div>
          </div>
          <div class="col-md-3 role-manager">
            <div class="summary-card">
              <h5>Available Stock</h5>
              <p class="summary-amount" id="stockTotal">0 KG</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="summary-card">
              <h5>Transactions Today</h5>
              <p class="summary-amount" id="todayTx">0</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Quick actions section -->
      <section class="role-manager role-sales">
        <h4 class="section-title mb-3">Quick Actions</h4>
        <div class="row g-3">
          <div class="col-md-3">
            <a
              href="./pages/cash-sale.html"
              class="btn btn-primary w-100 btn-lg"
            >
              Record Cash Sale
            </a>
          </div>
          <div class="col-md-3">
            <a
              href="./pages/credit-sale.html"
              class="btn btn-outline-primary w-100 btn-lg"
            >
              Record Credit Sale
            </a>
          </div>
          <div class="col-md-3 role-manager">
            <a
              href="./pages/procurement.html"
              class="btn btn-outline-secondary w-100 btn-lg"
            >
              Record Procurement
            </a>
          </div>
          <div class="col-md-3 role-manager">
            <a
              href="./pages/stock.html"
              class="btn btn-outline-secondary w-100 btn-lg"
            >
              View Stock
            </a>
          </div>
        </div>
      </section>
    </main>

    <!-- SCRIPTS -->
    <script src="./js/auth.js"></script>
    <script src="./js/dashboard.js"></script>

    <!--NAVBAR LOADER + LOGOUT -->
    <script>
      fetch("./navbar.html")
        .then((res) => {
          if (!res.ok) throw new Error("Navbar failed to load");
          return res.text();
        })
        .then((html) => {
          document.getElementById("navbar-container").innerHTML = html;

          /* ACTIVE DASHBOARD LINK */
          document.querySelectorAll(".nav-link").forEach((link) => {
            if (link.getAttribute("href") === "/frontend/dashboard.html") {
              link.classList.add("active");
            }
          });

          /* PROFILE DROPDOWN */
          const profileToggle = document.getElementById("profileToggle");
          const profileDropdown = document.getElementById("profileDropdown");

          if (profileToggle && profileDropdown) {
            profileToggle.addEventListener("click", (e) => {
              e.stopPropagation();
              profileDropdown.classList.toggle("open");
            });

            document.addEventListener("click", () => {
              profileDropdown.classList.remove("open");
            });

            profileDropdown.addEventListener("click", (e) => {
              e.stopPropagation();
            });
          }

          /* LOGOUT  */
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
              if (!confirm("Logout from Karibu Groceries?")) return;
              localStorage.removeItem("kglUser");
              window.location.href = "./index.html";
            });
          }

          /* MOBILE MENU */
          const mobileToggle = document.getElementById("mobileMenuToggle");
          const mobileNav = document.getElementById("mobileNavCollapse");

          if (mobileToggle && mobileNav) {
            mobileToggle.addEventListener("click", () => {
              mobileNav.classList.toggle("open");
            });
          }
        })
        .catch((err) => console.error(err));
    </script>
  </body>
</html>
